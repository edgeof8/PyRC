<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Codebase Overview | PyRC Wiki</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1>PyRC Documentation</h1>
                <p class="tagline">Complete guide to the Python IRC Client</p>
                <div class="search-box">
                    <input type="text" placeholder="Search documentation...">
                    <button><i class="fas fa-search"></i></button>
                </div>
            </div>
        </header>

        <div class="sidebar">
            <nav>
                <ul>
                    <li><a href="index.html"><i class="fas fa-home"></i> Home</a></li>

                    <li class="sidebar-header"><i class="fas fa-play-circle"></i> Getting Started</li>
                    <li><a href="quick-start.html"><i class="fas fa-bolt"></i> Quick Start</a></li>
                    <li><a href="getting-started.html"><i class="fas fa-rocket"></i> Getting Started</a></li>
                    <li><a href="development-setup.html"><i class="fas fa-code"></i> Development Setup</a></li>

                    <li class="sidebar-header"><i class="fas fa-cubes"></i> Core Components</li>
                    <li><a href="architecture.html"><i class="fas fa-project-diagram"></i> Architecture</a></li>
                    <li><a href="codebase-overview.html" class="active"><i class="fas fa-sitemap"></i> Codebase Overview</a></li>
                    <li><a href="core-components.html"><i class="fas fa-cube"></i> Core Components</a></li>
                    <li><a href="command-system.html"><i class="fas fa-terminal"></i> Command System</a></li>
                    <li><a href="ui-system.html"><i class="fas fa-desktop"></i> UI System</a></li>
                    <li><a href="dcc.html"><i class="fas fa-exchange-alt"></i> DCC</a></li>

                    <li class="sidebar-header"><i class="fas fa-plug"></i> API & Extensibility</li>
                    <li><a href="api-documentation.html"><i class="fas fa-book"></i> API Documentation</a></li>
                    <li><a href="script-api-reference.html"><i class="fas fa-code"></i> Script API Reference</a></li>
                    <li><a href="contributing.html"><i class="fas fa-hands-helping"></i> Contributing</a></li>

                    <li class="sidebar-header"><i class="fas fa-info-circle"></i> Support & Legal</li>
                    <li><a href="debugging-and-logging.html"><i class="fas fa-bug"></i> Debugging & Logging</a></li>
                    <li><a href="troubleshooting.html"><i class="fas fa-wrench"></i> Troubleshooting</a></li>
                    <li><a href="support.html"><i class="fas fa-question"></i> Support</a></li>
                    <li><a href="license.html"><i class="fas fa-file-contract"></i> License</a></li>
                    <li><a href="acknowledgments.html"><i class="fas fa-heart"></i> Acknowledgments</a></li>
                </ul>
            </nav>
        </div>

        <main>
            <article>
                <h2>Codebase Overview</h2>
                <p class="lead">PyRC's codebase is organized into a logical directory structure to promote modularity, maintainability, and clear separation of concerns.</p>

                <h3>Directory Structure</h3>
                <div class="code-container">
                    <pre><code>PyRC/
├── pyrc.py                     # Main application entry point and asyncio event loop setup
├── pyterm_irc_config.ini       # Main configuration file with server and client settings
│
├── pyrc_core/                  # Core application package
│   ├── __init__.py             # Package initialization
│   ├── app_config.py           # Centralized configuration management using configparser
│   ├── context_manager.py      # Manages chat contexts (channels, queries, server)
│   ├── event_manager.py        # Asynchronous event dispatching system
│   ├── network_handler.py      # Async IRC protocol handling using asyncio.StreamReader/Writer
│   └── state_manager.py        # Thread-safe state management with persistence
│
│   ├── client/                # Client implementation
│   │   ├── __init__.py
│   │   ├── connection_orchestrator.py  # Coordinates connection lifecycle and authentication
│   │   ├── irc_client_logic.py         # Main application logic and component coordination
│   │   ├── input_handler.py            # Async input processing and command dispatching
│   │   └── state_change_ui_handler.py  # Updates UI in response to state changes
│   │
│   ├── ui/                     # Terminal UI components
│   │   ├── __init__.py
│   │   ├── curses_manager.py          # Low-level Curses initialization and teardown
│   │   ├── curses_utils.py            # Safe Curses drawing utilities
│   │   ├── input_line_renderer.py     # Input prompt and text entry
│   │   ├── message_panel_renderer.py  # Chat message display
│   │   ├── sidebar_panel_renderer.py  # Channel/user list
│   │   ├── status_bar_renderer.py     # Status information display
│   │   ├── ui_manager.py              # UI component coordination
│   │   └── window_layout_manager.py   # Window layout calculations
│   │
│   ├── commands/              # Built-in command implementations
│   │   ├── __init__.py
│   │   ├── command_handler.py   # Command registration and dispatch
│   │   │
│   │   ├── channel/           # Commands for channel operations.
│   │   │   ├── __init__.py
│   │   │   ├── ban_commands.py       # /ban, /unban, /kickban
│   │   │   ├── cyclechannel_command.py # /cycle
│   │   │   ├── invite_command.py     # /invite
│   │   │   ├── join_command.py       # /join
│   │   │   ├── kick_command.py       # /kick
│   │   │   ├── mode_command.py       # /mode (channel modes)
│   │   │   ├── part_command.py       # /part
│   │   │   ├── simple_mode_commands.py # /op, /deop, /voice, etc.
│   │   │   └── topic_command.py      # /topic
│   │   │
│   │   ├── core/            # Essential client commands.
│   │   │   ├── __init__.py
│   │   │   └── help_command.py       # /help
│   │   │
│   │   ├── dcc/             # DCC file transfer and chat commands.
│   │   │   ├── __init__.py
│   │   │   ├── dcc_accept_command.py  # /dcc accept
│   │   │   ├── dcc_auto_command.py    # /dcc auto
│   │   │   ├── dcc_browse_command.py  # /dcc browse
│   │   │   ├── dcc_cancel_command.py  # /dcc cancel
│   │   │   ├── dcc_commands.py        # Main DCC command handler
│   │   │   ├── dcc_get_command.py     # /dcc get
│   │   │   ├── dcc_list_command.py    # /dcc list
│   │   │   ├── dcc_resume_command.py  # /dcc resume
│   │   │   └── dcc_send_command.py    # /dcc send
│   │   │
│   │   ├── information/     # Information retrieval commands.
│   │   │   ├── __init__.py
│   │   │   ├── list_command.py        # /list
│   │   │   ├── names_command.py       # /names
│   │   │   ├── who_command.py         # /who
│   │   │   └── whowas_command.py      # /whowas
│   │   │
│   │   ├── server/          # Server connection and management.
│   │   │   ├── __init__.py
│   │   │   ├── connect_command.py     # /connect
│   │   │   ├── disconnect_command.py  # /disconnect
│   │   │   ├── quit_command.py        # /quit
│   │   │   ├── raw_command.py         # /raw
│   │   │   ├── reconnect_command.py   # /reconnect
│   │   │   └── server_command.py      # /server
│   │   │
│   │   ├── ui/              # User interface controls.
│   │   │   ├── __init__.py
│   │   │   ├── close_command.py       # /close
│   │   │   ├── split_screen_commands.py # /split, /unsplit
│   │   │   ├── status_command.py      # /status
│   │   │   ├── userlist_scroll_command.py # /scrollusers
│   │   │   └── window_navigation_commands.py # /window, /next, /prev
│   │   │
│   │   ├── user/            # User interaction commands.
│   │   │   ├── __init__.py
│   │   │   ├── away_command.py        # /away
│   │   │   ├── ignore_commands.py     # /ignore, /unignore, /listignores
│   │   │   ├── me_command.py          # /me
│   │   │   ├── msg_command.py         # /msg
│   │   │   ├── nick_command.py        # /nick
│   │   │   ├── notice_command.py      # /notice
│   │   │   └── query_command.py       # /query
│   │   │
│   │   └── utility/         # Utility and configuration commands.
│   │       ├── __init__.py
│   │       ├── clear_command.py       # /clear
│   │       ├── execute_command.py     # /exec
│   │       ├── rehash_command.py      # /rehash
│   │       ├── save_command.py        # /save
│   │       ├── script_command.py      # /script
│   │       ├── set_command.py         # /set
│   │       ├── show_command.py        # /show
│   │       └── trigger_command.py     # /trigger
│   │
│   ├── dcc/                   # DCC (Direct Client-to-Client) feature implementation.
│   │   ├── __init__.py
│   │   ├── dcc_ctcp_handler.py # Handles incoming DCC CTCP requests.
│   │   ├── dcc_manager.py      # Main orchestrator for all DCC functionality.
│   │   ├── dcc_passive_offer_manager.py # Manages passive (reverse) DCC offers.
│   │   ├── dcc_protocol.py     # Parses and formats DCC CTCP messages.
│   │   ├── dcc_receive_manager.py # Manages all incoming file transfers.
│   │   ├── dcc_security.py     # Filename sanitization and path validation.
│   │   ├── dcc_send_manager.py # Manages all outgoing file transfers.
│   │   ├── dcc_transfer.py     # Base classes for DCC send/receive transfer logic.
│   │   └── dcc_utils.py        # Shared utility functions (e.g., socket creation).
│   │
│   ├── features/              # Self-contained, optional features.
│   │   └── triggers/          # Implementation of the /on command trigger system.
│   │       ├── __init__.py
│   │       ├── trigger_commands.py
│   │       └── trigger_manager.py
│   │
│   ├── irc/                  # IRC protocol logic and message handling.
│   │   ├── __init__.py
│   │   ├── cap_negotiator.py   # Handles IRCv3 capability negotiation.
│   │   ├── irc_message.py     # Parses raw IRC lines into structured message objects.
│   │   ├── irc_protocol.py    # Main dispatcher for incoming server messages.
│   │   ├── registration_handler.py  # Manages NICK/USER registration sequence.
│   │   ├── sasl_authenticator.py    # Handles SASL PLAIN authentication.
│   │   └── handlers/          # Specific handlers for different IRC commands/numerics.
│   │       ├── __init__.py
│   │       ├── irc_numeric_handlers.py # Handlers for server numeric replies.
│   │       ├── membership_handlers.py  # Handlers for JOIN, PART, QUIT, KICK.
│   │       ├── message_handlers.py     # Handlers for PRIVMSG, NOTICE.
│   │       ├── protocol_flow_handlers.py # Handlers for PING, CAP, etc.
│   │       └── state_change_handlers.py # Handlers for NICK, MODE, etc.
│   │
│   ├── logging/              # Logging-specific components.
│   │   └── channel_logger.py  # Manages per-channel and status window log files.
│   │
│   └── scripting/            # The Python scripting engine.
│       ├── __init__.py
│       ├── api_responder_agent.py # Example AI agent script.
│       ├── python_trigger_api.py  # API for the /on <event> PY <code> trigger action.
│       ├── script_api_handler.py  # Provides the `api` object for scripts.
│       ├── script_base.py     # A base class for scripts to inherit from.
│       └── script_manager.py  # Discovers, loads, and manages all user scripts.
│
├── scripts/                  # Directory for user-provided Python scripts and test utilities.
│   ├── ai_api_test_script.py    # Test script for AI API integration.
│   ├── default_exit_handler.py  # Default exit handler script.
│   ├── default_fun_commands.py  # Example script with fun commands.
│   ├── default_random_messages.py  # Random message generator for testing.
│   ├── event_test_script.py     # Script for testing event handling.
│   ├── run_headless_tests.py    # Entry point for running headless tests.
│   ├── test_dcc_features.py     # Tests for DCC functionality.
│   ├── test_headless.py         # Headless test runner.
│   └── test_script.py          # General test script.
│
├── config/                   # Directory for runtime-generated configuration files.
│   └── triggers.json         # Stores persistent user-defined triggers.
│
├── data/                     # Directory for static data files.
│   └── default_help/
│       └── command_help.ini  # Fallback help texts for core commands.
│
└── pyterm_irc_config.ini.example  # Example configuration file. Copy to create config.</code></pre>
                </div>

                <h3>Key Components</h3>
                <p>PyRC's core functionality is distributed across several key components, each responsible for a specific aspect of the client's operation:</p>

                <div class="component-section">
                    <h4><i class="fas fa-cogs"></i> Core Application Modules (<code>pyrc_core/</code>)</h4>
                    <ul>
                        <li><strong><code>app_config.py</code></strong>: Centralized management of all application and server settings.</li>
                        <li><strong><code>context_manager.py</code></strong>: Manages various chat contexts (channels, private queries, server status window).</li>
                        <li><strong><code>event_manager.py</code></strong>: The central asynchronous event dispatching system, enabling loose coupling between components.</li>
                        <li><strong><code>network_handler.py</code></strong>: Handles asynchronous network I/O using <code>asyncio.StreamReader</code> and <code>StreamWriter</code> for sending and receiving raw IRC data.</li>
                        <li><strong><code>state_manager.py</code></strong>: The single, thread-safe source of truth for all connection, session, and client-specific runtime state, with automatic persistence.</li>
                    </ul>
                </div>

                <div class="component-section">
                    <h4><i class="fas fa-laptop-code"></i> Client Implementation (<code>pyrc_core/client/</code>)</h4>
                    <ul>
                        <li><strong><code>irc_client_logic.py</code></strong>: The main application logic, coordinating interactions between core components and managing the primary asyncio event loop.</li>
                        <li><strong><code>connection_orchestrator.py</code></strong>: Manages the entire lifecycle of server connections, including CAP negotiation, SASL authentication, and registration.</li>
                        <li><strong><code>input_handler.py</code></strong>: Processes user input, translating key presses into commands or messages.</li>
                        <li><strong><code>state_change_ui_handler.py</code></strong>: Responsible for updating the User Interface in response to changes in the application state.</li>
                    </ul>
                </div>

                <div class="component-section">
                    <h4><i class="fas fa-terminal"></i> Command System (<code>pyrc_core/commands/</code>)</h4>
                    <ul>
                        <li><strong><code>command_handler.py</code></strong>: Discovers, registers, and dispatches all built-in and script-defined commands.</li>
                        <li><strong>Subdirectories (e.g., <code>channel/</code>, <code>server/</code>, <code>dcc/</code>, <code>ui/</code>, <code>user/</code>, <code>utility/</code>)</strong>: Contain individual Python modules implementing specific command categories. Commands are dynamically loaded from these directories.</li>
                    </ul>
                </div>

                <div class="component-section">
                    <h4><i class="fas fa-exchange-alt"></i> DCC (Direct Client-to-Client) (<code>pyrc_core/dcc/</code>)</h4>
                    <ul>
                        <li><strong><code>dcc_manager.py</code></strong>: Orchestrates all DCC send and receive operations.</li>
                        <li><strong><code>dcc_ctcp_handler.py</code></strong>: Handles incoming DCC CTCP requests.</li>
                        <li><strong><code>dcc_send_manager.py</code></strong> & <strong><code>dcc_receive_manager.py</code></strong>: Manage outgoing and incoming file transfers, respectively.</li>
                        <li><strong><code>dcc_security.py</code></strong>: Provides filename sanitization and path validation for safe transfers.</li>
                    </ul>
                </div>

                <div class="component-section">
                    <h4><i class="fas fa-plug"></i> Scripting Engine (<code>pyrc_core/scripting/</code>)</h4>
                    <ul>
                        <li><strong><code>script_manager.py</code></strong>: Discovers, loads, and manages user-provided Python scripts.</li>
                        <li><strong><code>script_api_handler.py</code></strong>: Provides the API object (<code>self.api</code>) that scripts use to interact with the client.</li>
                        <li><strong><code>python_trigger_api.py</code></strong>: Implements the API for the <code>/on <event> PY <code></code> trigger action.</li>
                    </ul>
                </div>

                <div class="component-section">
                    <h4><i class="fas fa-comments"></i> IRC Protocol Logic (<code>pyrc_core/irc/</code>)</h4>
                    <ul>
                        <li><strong><code>irc_message.py</code></strong>: Parses raw IRC lines into structured message objects.</li>
                        <li><strong><code>irc_protocol.py</code></strong>: The main dispatcher for incoming server messages, directing them to appropriate handlers.</li>
                        <li><strong><code>cap_negotiator.py</code></strong>: Handles IRCv3 capability negotiation.</li>
                        <li><strong><code>sasl_authenticator.py</code></strong>: Manages SASL PLAIN authentication.</li>
                        <li><strong><code>registration_handler.py</code></strong>: Manages the NICK/USER registration sequence.</li>
                        <li><strong><code>handlers/</code></strong>: Contains specific handlers for various IRC commands and numeric replies (e.g., <code>PRIVMSG</code>, <code>JOIN</code>, <code>RPL_WELCOME</code>).</li>
                    </ul>
                </div>

                <div class="component-section">
                    <h4><i class="fas fa-desktop"></i> UI System (<code>pyrc_core/ui/</code>)</h4>
                    <ul>
                        <li><strong><code>ui_manager.py</code></strong>: Coordinates all UI components and refresh cycles.</li>
                        <li><strong><code>curses_manager.py</code></strong>: Manages low-level `curses` initialization, teardown, and basic terminal interactions.</li>
                        <li><strong><code>window_layout_manager.py</code></strong>: Calculates and manages the layout, sizing, and positioning of all UI windows (message panel, sidebar, input line, status bar).</li>
                        <li><strong><code>message_panel_renderer.py</code></strong>, <strong><code>sidebar_panel_renderer.py</code></strong>, <strong><code>status_bar_renderer.py</code></strong>, <strong><code>input_line_renderer.py</code></strong>: Dedicated components for rendering specific parts of the terminal UI.</li>
                        <li><strong><code>curses_utils.py</code></strong>: Provides safe, utility functions for `curses` drawing operations.</li>
                    </ul>
                </div>

                <div class="component-section">
                    <h4><i class="fas fa-file-alt"></i> Logging (<code>pyrc_core/logging/</code>)</h4>
                    <ul>
                        <li><strong><code>channel_logger.py</code></strong>: Manages per-channel and status window log files, ensuring message history is persisted.</li>
                    </ul>
                </div>
            </article>
        </main>

        <footer>
            <p>PyRC &copy; 2025 | Open Source IRC Client | MIT Licensed</p>
        </footer>
    </div>
</body>
</html>
