<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architecture - PyRC Documentation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
    <link rel="stylesheet" href="/docs/wiki/styles.css">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>Architecture</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#overview">Overview</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#core-components">Core Components</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#event-system">Event System</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#state-management">State Management</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#network-layer">Network Layer</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">PyRC Architecture</h1>
                </div>

                <section id="overview">
                    <h2>Architecture Overview</h2>
                    <p>PyRC is built with a modular, event-driven architecture that separates concerns and promotes maintainability. The application follows these key architectural principles:</p>
                    
                    <ul>
                        <li><strong>Asynchronous by Design</strong>: Built on Python's asyncio for high concurrency</li>
                        <li><strong>Event-Driven</strong>: Components communicate through a centralized event system</li>
                        <li><strong>Modular</strong>: Features are organized into independent, reusable components</li>
                        <li><strong>Extensible</strong>: Plugin system for adding new functionality</li>
                    </ul>
                    
                    <div class="alert alert-info mt-4">
                        <strong>Note:</strong> PyRC's architecture is designed to be both powerful for advanced users and approachable for those new to IRC clients.
                    </div>
                </section>

                <section id="core-components" class="mt-5">
                    <h2>Core Components</h2>
                    <p>PyRC is composed of several key components that work together:</p>
                    
                    <div class="row mt-4">
                        <div class="col-md-6 mb-4">
                            <div class="card h-100">
                                <div class="card-header">IRC Client Logic</div>
                                <div class="card-body">
                                    <p>The main application logic that orchestrates all other components. Handles the IRC protocol state and user interactions.</p>
                                    <code>pyrc_core/client/irc_client_logic.py</code>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-4">
                            <div class="card h-100">
                                <div class="card-header">Network Handler</div>
                                <div class="card-body">
                                    <p>Manages network connections, including connection, reconnection, and message I/O.</p>
                                    <code>pyrc_core/network_handler.py</code>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-4">
                            <div class="card h-100">
                                <div class="card-header">State Manager</div>
                                <div class="card-body">
                                    <p>Manages application state in a thread-safe manner, with persistence and validation.</p>
                                    <code>pyrc_core/state_manager.py</code>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-4">
                            <div class="card h-100">
                                <div class="card-header">Event Manager</div>
                                <div class="card-body">
                                    <p>Handles event dispatching between components and to scripts.</p>
                                    <code>pyrc_core/event_manager.py</code>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="event-system" class="mt-5">
                    <h2>Event System</h2>
                    <p>PyRC's event system enables loose coupling between components. Events are used for all significant state changes and user interactions.</p>
                    
                    <h4 class="mt-4">Key Events</h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Event</th>
                                <th>Description</th>
                                <th>Data</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>CONNECTION_STATE_CHANGED</code></td>
                                <td>Triggered when connection state changes</td>
                                <td><code>{state: 'CONNECTED'|'DISCONNECTED', ...}</code></td>
                            </tr>
                            <tr>
                                <td><code>MESSAGE_RECEIVED</code></td>
                                <td>When a message is received from the server</td>
                                <td><code>{from: 'nick', target: '#channel', message: '...'}</code></td>
                            </tr>
                            <tr>
                                <td><code>MESSAGE_SENT</code></td>
                                <td>When the user sends a message</td>
                                <td><code>{target: '#channel', message: '...'}</code></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="alert alert-warning mt-4">
                        <strong>Note:</strong> All event handlers should be asynchronous to avoid blocking the main event loop.
                    </div>
                </section>

                <section id="state-management" class="mt-5">
                    <h2>State Management</h2>
                    <p>PyRC uses a centralized state management system to maintain application state in a predictable way.</p>
                    
                    <h4 class="mt-4">State Structure</h4>
                    <pre><code class="language-python">{
    'connection': {
        'state': 'CONNECTED',
        'server': 'irc.example.com',
        'nick': 'mynick'
    },
    'channels': {
        '#python': {
            'users': ['user1', 'user2'],
            'topic': 'Python programming',
            'unread': 0
        }
    },
    'settings': {
        'notifications': True,
        'theme': 'dark'
    }
}</code></pre>
                    
                    <h4 class="mt-4">State Updates</h4>
                    <p>State updates are performed through the StateManager, which provides methods like:</p>
                    <ul>
                        <li><code>set(key, value)</code> - Update a state value</li>
                        <li><code>get(key, default=None)</code> - Retrieve a state value</li>
                        <li><code>subscribe(callback, keys=None)</code> - Subscribe to state changes</li>
                    </ul>
                </section>

                <section id="network-layer" class="mt-5">
                    <h2>Network Layer</h2>
                    <p>The network layer handles all IRC protocol communication with the server.</p>
                    
                    <h4 class="mt-4">Key Features</h4>
                    <ul>
                        <li>Asynchronous I/O using asyncio</li>
                        <li>Automatic reconnection with exponential backoff</li>
                        <li>Message queuing and rate limiting</li>
                        <li>SSL/TLS support</li>
                        <li>SASL authentication</li>
                    </ul>
                    
                    <h4 class="mt-4">Connection Lifecycle</h4>
                    <ol>
                        <li>DNS resolution</li>
                        <li>TCP connection</li>
                        <li>TLS handshake (if enabled)</li>
                        <li>CAP negotiation</li>
                        <li>SASL authentication (if configured)</li>
                        <li>User registration</li>
                        <li>Normal operation</li>
                    </ol>
                    
                    <div class="alert alert-info mt-4">
                        <strong>Tip:</strong> The network layer automatically handles ping/pong to keep the connection alive.
                    </div>
                </section>
            </main>
        </div>
    </div>

    <a href="#" class="back-to-top" id="backToTop">↑</a>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>
        // Initialize syntax highlighting
        document.addEventListener('DOMContentLoaded', function() {
            // Highlight all code blocks
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
            
            // Back to top button
            const backToTop = document.getElementById('backToTop');
            window.addEventListener('scroll', function() {
                if (window.pageYOffset > 300) {
                    backToTop.style.display = 'flex';
                } else {
                    backToTop.style.display = 'none';
                }
            });
            
            backToTop.addEventListener('click', function(e) {
                e.preventDefault();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        });
    </script>
</body>
</html>
